# 🔧 機能追加・修正時のチェックリスト

## 📋 新しいデータプロパティを追加する場合

### 1. データベース（Supabase）
- [ ] **テーブルスキーマの確認** - 新しいカラムが必要か？
- [ ] **SQLスクリプトの作成** - ALTER TABLE文
- [ ] **外部操作の事前告知** - SQLスクリプト実行が必要な旨をユーザーに伝える
- [ ] **データ型・制約の確認** - DEFAULT値、NULL許可等

### 2. TypeScript型定義
- [ ] **types/*.ts** - インターフェース・型定義の更新
- [ ] **既存データとの互換性** - optional (?) やデフォルト値の設定

### 3. API層（app/api/）
- [ ] **GET処理** - データ取得時に新プロパティを含める
- [ ] **POST処理** - データ保存時に新プロパティを処理
- [ ] **PUT/PATCH処理** - 更新処理がある場合
- [ ] **バリデーション** - 新プロパティの検証ロジック

### 4. フロントエンド（データ取得）
- [ ] **app/page.tsx** - サーバーサイドでの直接Supabase取得
- [ ] **components/PageRenderer.tsx** - 表示処理
- [ ] **デフォルトデータ** - フォールバック用のデフォルト値設定

### 5. エディタ機能
- [ ] **エディタコンポーネント** - 新プロパティの編集機能
- [ ] **保存処理** - エディタからAPIへの送信
- [ ] **プレビュー機能** - エディタでの表示確認

### 6. 表示・レンダリング
- [ ] **PageRenderer** - 実際の表示処理
- [ ] **CSS/スタイル** - 新プロパティに応じたスタイリング
- [ ] **レスポンシブ対応** - モバイル・タブレット対応

## 🔍 セクション別修正チェック

### MainVisual セクション
- [ ] `components/sections/MainVisualEditor.tsx`
- [ ] `main_visual_sections` テーブル
- [ ] API: `section.layout === "mainVisual"` 部分

### ImgText セクション  
- [ ] `components/sections/ImgTextEditor.tsx`
- [ ] `img_text_sections` テーブル
- [ ] API: `section.layout === "imgText"` 部分

### Cards セクション
- [ ] `components/sections/CardsEditor.tsx`
- [ ] `cards` テーブル (セクション自体は`cards_sections`)
- [ ] API: `section.layout === "cards"` 部分
- [ ] 個別カードの処理も確認

### Form セクション
- [ ] `components/sections/FormEditor.tsx`
- [ ] `form_sections` テーブル
- [ ] API: `section.layout === "form"` 部分

## 🚨 外部操作が必要な場合

### データベース操作
- [ ] **事前告知** - SQLスクリプト実行が必要な旨を明記
- [ ] **権限確認方法** - 実行権限の確認手順を提示
- [ ] **バックアップ推奨** - 本番環境での注意事項
- [ ] **実行手順** - 具体的な操作方法

### 環境変数・設定
- [ ] **新しい環境変数** - 追加が必要な場合
- [ ] **外部サービス設定** - Supabase、OpenAI等の設定変更
- [ ] **デプロイ設定** - Vercel等の設定更新

## 📝 確認テスト

### 基本動作確認
- [ ] **エディタでの編集** - 新機能が正常に動作するか
- [ ] **保存処理** - データベースに正しく保存されるか
- [ ] **表示確認** - トップページで正しく表示されるか
- [ ] **プレビューとの一致** - エディタプレビューとトップページが一致するか

### エラーハンドリング
- [ ] **データがない場合** - デフォルト値やフォールバック
- [ ] **無効な値の場合** - バリデーション・エラー処理
- [ ] **外部サービス障害** - Supabase接続エラー等

## 🎯 今後のルール

1. **新プロパティ追加時は必ず上記チェックリストを確認**
2. **外部操作が必要な場合は最初に明記**
3. **修正箇所をすべてリストアップしてから作業開始**
4. **API・データベース・フロントエンドの3層すべてを確認** 